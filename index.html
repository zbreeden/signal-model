<!doctype html>
<html lang="en">
<head>
  <!-- The Signal (ğŸ“¡) â€” Core System: Nerves of the architecture
       Purpose: UX/marketing telemetry playground with live KPIs powered by the inâ€‘page dataLayer.
       Notes:
         â€¢ Back button returns to the FourTwenty hub.
         â€¢ Replace GTM ID below with your container if different.
         â€¢ Events follow the repoâ€™s MVP taxonomy: page_view, cta_click, nav_search, form_submit.
  -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="FourTwenty â€¢ The Signal â€” UX telemetry playground with live KPIs (GA/GTM ready)." />
  <meta name="color-scheme" content="light dark" />
  <title>FourTwenty â€¢ The Signal ğŸ“¡</title>

  <!-- Google Tag Manager (GTM) â€” prefer deploying GA4 via GTM. Avoid double page_view in GA4. -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
      j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WVC4SNLB');  /* â† replace with your GTM ID if needed */
  </script>

  <style>
    :root {
      --bg: color-mix(in oklab, Canvas 95%, #0a0a0a 5%);
      --card: color-mix(in oklab, Canvas 88%, #0a0a0a 12%);
      --ink: CanvasText;
      --muted: color-mix(in oklab, var(--ink) 65%, transparent);
      --accent: #4f46e5; /* indigo */
      --ok: #16a34a;
      --warn: #d97706;
      --bad: #dc2626;
      --radius: 18px;
      --shadow: 0 8px 24px color-mix(in oklab, black 15%, transparent);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font: 15px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--ink);
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px; }
    header { display: grid; grid-template-columns: 140px 1fr auto; gap: 16px; align-items: center; margin-bottom: 18px; }
    .back { display: inline-flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 999px; background: var(--card); box-shadow: var(--shadow); }
    .back span { font-weight: 600; }
    .title { display: flex; flex-direction: column; gap: 6px; }
    .title h1 { margin: 0; font-size: 22px; letter-spacing: .2px; }
    .pill { display: inline-flex; gap: 8px; align-items: center; font-size: 12px; color: var(--muted); }
    .links { display: flex; gap: 10px; }

    .grid { display: grid; grid-template-columns: 1.2fr .8fr; gap: 18px; }
    .card { background: var(--card); border-radius: var(--radius); padding: 16px 16px; box-shadow: var(--shadow); }
    .card h3 { margin: 0 0 10px; font-size: 16px; letter-spacing: .2px; }
    .card p { margin: 8px 0; color: var(--muted); }

    .kpis { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; }
    .kpi { background: var(--card); border-radius: 14px; padding: 12px; box-shadow: var(--shadow); }
    .kpi .label { font-size: 11px; color: var(--muted); }
    .kpi .value { font-size: 22px; font-weight: 700; letter-spacing: .3px; }
    .kpi .delta { font-size: 11px; }

    .play { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .stack { display: grid; gap: 10px; }
    .row { display: flex; gap: 8px; }
    input[type="text"], input[type="email"], input[type="search"], button, .soft-btn {
      border: 0; background: color-mix(in oklab, var(--card) 86%, #000 14%);
      color: var(--ink); padding: 10px 12px; border-radius: 12px; box-shadow: var(--shadow);
    }
    input::placeholder { color: var(--muted); }
    button, .soft-btn { cursor: pointer; font-weight: 600; }
    .cta { background: linear-gradient(135deg, var(--accent), color-mix(in oklab, var(--accent) 60%, #22d3ee)); color: white; }

    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th, td { padding: 8px 10px; border-bottom: 1px solid color-mix(in oklab, var(--ink) 10%, transparent); vertical-align: top; }
    thead th { text-align: left; position: sticky; top: 0; background: var(--card); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
      .kpis { grid-template-columns: repeat(3, 1fr); }
      .play { grid-template-columns: 1fr; }
      header { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <noscript><div style="padding:12px; background:#fee2e2; color:#7f1d1d; text-align:center;">This page uses JavaScript to simulate UX events and compute KPIs.</div></noscript>

  <div class="wrap">
    <header>
      <a class="back" href="https://zbreeden.github.io/FourTwentyAnalytics/" onclick="track('cta_click',{cta_id:'back_to_hub', cta_text:'Back', location:'header'})">
        <span>â† Hub</span>
      </a>
      <div class="title">
        <h1>ğŸ“¡ FourTwenty â€¢ The Signal</h1>
        <div class="pill">Core System â€¢ Nerves scanning for opportunity â€¢ JS/GA/UXâ€‘focused</div>
      </div>
      <div class="links">
        <a class="soft-btn" href="https://github.com/zbreeden/signal-model" target="_blank" rel="noopener" onclick="track('cta_click',{cta_id:'open_repo', cta_text:'Open Repo', location:'header'})">Repo</a>
        <a class="soft-btn" href="https://github.com/zbreeden/signal-model/blob/main/README.md" target="_blank" rel="noopener" onclick="track('cta_click',{cta_id:'open_readme', cta_text:'Open README', location:'header'})">README</a>
        <a class="soft-btn" href="https://tagassistant.google.com/" target="_blank" rel="noopener" onclick="track('cta_click',{cta_id:'tag_assistant', cta_text:'Tag Assistant', location:'header'})">Tag Assistant</a>
      </div>
    </header>

    <!-- KPI band -->
    <section class="kpis" aria-label="Session KPIs">
      <div class="kpi"><div class="label">CTR (CTA clicks / views)</div><div id="kpi_ctr" class="value">â€”</div><div id="kpi_ctr_delta" class="delta"></div></div>
      <div class="kpi"><div class="label">Form Conversion</div><div id="kpi_conv" class="value">â€”</div><div id="kpi_conv_delta" class="delta"></div></div>
      <div class="kpi"><div class="label">Search Utilization</div><div id="kpi_search" class="value">â€”</div><div id="kpi_search_delta" class="delta"></div></div>
      <div class="kpi"><div class="label">Avg Scroll Depth</div><div id="kpi_scroll" class="value">0%</div><div class="delta">session</div></div>
      <div class="kpi"><div class="label">Dwell Time</div><div id="kpi_time" class="value">0s</div><div class="delta">live</div></div>
      <div class="kpi"><div class="label">Events Seen</div><div id="kpi_events" class="value">0</div><div class="delta">dataLayer</div></div>
    </section>

    <div class="grid" style="margin-top: 16px;">
      <!-- Mission + Playground -->
      <section class="card">
        <h3>Mission & Quick Start</h3>
        <p>
          The Signal looks for opportunity: it emits small, typed <span class="mono">dataLayer</span> events and listens for value in return.
          Use this playground to validate your GTM/GA4 wiring and to demo UX metrics.
        </p>
        <ul>
          <li>Events: <span class="mono">page_view</span>, <span class="mono">cta_click</span>, <span class="mono">nav_search</span>, <span class="mono">form_submit</span>.</li>
          <li>Verify in GA4 <em>DebugView</em> (via Tag Assistant) and see live events below.</li>
          <li>KPIs here are computed clientâ€‘side for the current session for demos.</li>
        </ul>

        <div class="play" style="margin-top:10px;">
          <div class="stack">
            <h3>Try the Signals</h3>
            <div class="row">
              <button class="cta" id="demo_cta">Primary CTA</button>
              <button class="soft-btn" id="soft_page">Soft Page Change</button>
            </div>
            <div class="row">
              <input id="search_box" type="search" placeholder="Searchâ€¦" />
              <button id="search_btn">Search</button>
            </div>
            <form id="demo_form" class="stack" onsubmit="return false;">
              <div class="row">
                <input type="text" id="name" placeholder="Name" required />
                <input type="email" id="email" placeholder="Email" required />
              </div>
              <button class="cta" id="form_submit_btn">Submit Demo Form</button>
            </form>
          </div>

          <div class="stack">
            <h3>Event Feed (dataLayer)</h3>
            <div class="card" style="padding:0; overflow:auto; max-height:340px;">
              <table>
                <thead><tr><th style="width:120px;">time</th><th style="width:140px;">event</th><th>params</th></tr></thead>
                <tbody id="feed"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Reference -->
      <aside class="card">
        <h3>Reference</h3>
        <p><strong>Event taxonomy (MVP)</strong></p>
        <table class="mono">
          <thead><tr><th>event_name</th><th>when it fires</th><th>params</th></tr></thead>
          <tbody>
            <tr><td>cta_click</td><td>primary CTA is clicked</td><td>cta_id, cta_text, location</td></tr>
            <tr><td>form_submit</td><td>lead/contact form submits</td><td>form_id, form_name, fields_count</td></tr>
            <tr><td>nav_search</td><td>a search query is submitted</td><td>query, results_count</td></tr>
            <tr><td>page_view</td><td>virtual/soft page change</td><td>page_id, page_title</td></tr>
          </tbody>
        </table>
        <p style="margin-top:8px;">See repo <span class="mono">/ga4/events.json</span> for the full spec.</p>
      </aside>
    </div>

    <section class="card" style="margin-top:16px;">
      <h3>Notes</h3>
      <ul>
        <li>KPIs you might track here for marketing/UX: CTR, form conversion, search utilization, dwell/scroll depth, bounce/engagement, top CTAs and queries.</li>
        <li>Wire GTM to GA4: map these events to GA4 events and params; validate in DebugView.</li>
        <li>To avoid a duplicate <span class="mono">page_view</span>, either use this virtual event only or disable auto page_view from your GA4 config.</li>
      </ul>
    </section>
  </div>

  <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Tiny telemetry helper: window.dataLayer + track
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.dataLayer = window.dataLayer || [];

    // Intercept pushes so we can update the UI feed as events flow
    (function(){
      const _push = window.dataLayer.push.bind(window.dataLayer);
      window.dataLayer.push = function(obj){
        try { renderEvent(obj); recalc(obj); } catch(e) { console.error(e); }
        return _push(obj);
      };
    })();

    function track(event, params={}){
      const payload = Object.assign({ event, ts: Date.now() }, params);
      window.dataLayer.push(payload);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Demo interactions â†’ events
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const byId = (id) => document.getElementById(id);
    const feed = byId('feed');
    const metrics = { views: 0, cta: 0, forms: 0, searches: 0, scrollMax: 0, events: 0 };

    // Primary CTA
    byId('demo_cta').addEventListener('click', () => {
      track('cta_click', { cta_id: 'primary', cta_text: 'Primary CTA', location: 'playground' });
    });

    // Soft page change (virtual page_view)
    byId('soft_page').addEventListener('click', () => {
      const pid = 'signal_alt_' + Math.floor(Math.random()*1000);
      track('page_view', { page_id: pid, page_title: 'The Signal â€¢ Alt' });
    });

    // Search
    byId('search_btn').addEventListener('click', () => {
      const q = byId('search_box').value.trim();
      if(!q) return;
      // Fake result count for demo
      const results = Math.floor(3 + Math.random()*42);
      track('nav_search', { query: q, results_count: results });
    });

    // Form
    byId('form_submit_btn').addEventListener('click', () => {
      const name = byId('name').value.trim();
      const email = byId('email').value.trim();
      if(!name || !email) return;
      track('form_submit', { form_id: 'demo_lead', form_name: 'Demo Lead', fields_count: 2 });
      // clear
      byId('name').value=''; byId('email').value='';
    });

    // Scroll depth (session max %)
    let scrollMax = 0;
    window.addEventListener('scroll', () => {
      const h = document.documentElement;
      const pct = Math.round(100 * (h.scrollTop)/(h.scrollHeight - h.clientHeight || 1));
      scrollMax = Math.max(scrollMax, pct);
      metrics.scrollMax = scrollMax;
      byId('kpi_scroll').textContent = scrollMax + '%';
    }, { passive: true });

    // Dwell time
    const t0 = Date.now();
    setInterval(() => {
      const secs = Math.floor((Date.now()-t0)/1000);
      byId('kpi_time').textContent = secs + 's';
    }, 1000);

    // Initial virtual page view for this session (if you rely on GTM auto page_view, you can remove this)
    track('page_view', { page_id:'signal_home', page_title:'The Signal â€¢ Home' });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // UI: render feed + recalc KPIs
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderEvent(obj){
      metrics.events++;
      const tr = document.createElement('tr');
      const time = new Date(obj.ts || Date.now()).toLocaleTimeString([], { hour:'2-digit', minute:'2-digit', second:'2-digit' });
      tr.innerHTML = `<td class="mono">${time}</td><td class="mono">${obj.event || ''}</td><td class="mono">${escapeHtml(JSON.stringify(obj))}</td>`;
      feed.prepend(tr);
      byId('kpi_events').textContent = metrics.events;
    }

    function recalc(obj){
      switch(obj.event){
        case 'page_view': metrics.views++; break;
        case 'cta_click': metrics.cta++; break;
        case 'form_submit': metrics.forms++; break;
        case 'nav_search': metrics.searches++; break;
      }
      const pct = (num, den) => den > 0 ? Math.round((1000*num/den))/10 + '%' : 'â€”';
      byId('kpi_ctr').textContent = pct(metrics.cta, metrics.views);
      byId('kpi_conv').textContent = pct(metrics.forms, metrics.views);
      byId('kpi_search').textContent = pct(metrics.searches, metrics.views);
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
    }
  </script>
</body>
</html>
